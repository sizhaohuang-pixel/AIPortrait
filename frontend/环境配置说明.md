# 小程序环境配置说明

> 老王提示：这个文档告诉你怎么配置小程序的生产环境URL，别tm搞错了！

## 快速配置（重要！）

### UniApp 配置方式

**艹，UniApp 不支持 `.env` 文件！** 需要直接修改配置文件：

1. **打开配置文件**：
   ```
   frontend/services/config.js
   ```

2. **修改第 10 行的生产环境 URL**：
   ```javascript
   // ==================== 重要配置 ====================
   // 艹，生产环境的 API 地址，打包前记得改这里！
   const PRODUCTION_BASE_URL = 'https://你的生产域名.com'  // 改成你的生产域名
   // ================================================
   ```

3. **保存文件，重新打包**

## 配置说明

### 开发环境（本地调试）
- **URL**：`http://localhost:8000`
- **使用场景**：在 HBuilderX 中点击"运行"时使用
- **自动判断**：代码会自动使用 localhost

### 生产环境（打包发布）
- **URL**：需要在 `config.js` 中配置 `PRODUCTION_BASE_URL`
- **使用场景**：
  - 微信小程序打包发布
  - App 打包发布
- **必须配置**：打包前必须修改 `PRODUCTION_BASE_URL`

## 验证配置

### 方法一：在代码中打印
在小程序启动时，可以在 `App.vue` 的 `onLaunch` 中添加：

```javascript
import { API_CONFIG } from './services/config.js'

export default {
  onLaunch() {
    console.log('当前 API 地址:', API_CONFIG.baseURL)
  }
}
```

### 方法二：查看网络请求
1. 打开微信开发者工具
2. 点击"调试器" → "Network"
3. 查看请求的 URL 是否正确

## 常见问题

### Q1: 为什么打包后还是请求 localhost？
**A:** UniApp 不支持 `.env` 文件，需要直接修改 `services/config.js` 中的 `PRODUCTION_BASE_URL`

### Q2: 如何区分开发和生产环境？
**A:**
- **H5 环境**：通过 `process.env.NODE_ENV` 自动判断
- **小程序/App 环境**：直接使用 `PRODUCTION_BASE_URL`

### Q3: 修改了配置但不生效？
**A:**
1. 确认修改的是 `services/config.js` 文件
2. 关闭微信开发者工具
3. 删除 `frontend/unpackage/` 目录
4. 重新打包

### Q4: 开发时想用本地环境怎么办？
**A:**
- **H5 开发**：自动使用 localhost，无需修改
- **小程序开发**：临时把 `PRODUCTION_BASE_URL` 改成 `http://localhost:8000`，记得打包前改回来

## 配置文件位置

```
frontend/
├── services/
│   └── config.js          ← 在这里配置生产环境 URL
├── .env.development       ← UniApp 不支持，可以删除
├── .env.production        ← UniApp 不支持，可以删除
└── .env.example           ← UniApp 不支持，可以删除
```

## 技术细节

### UniApp 条件编译
配置文件使用了 UniApp 的条件编译：

```javascript
// #ifdef H5
baseURL: process.env.NODE_ENV === 'production'
    ? PRODUCTION_BASE_URL
    : 'http://localhost:8000',
// #endif
// #ifndef H5
baseURL: PRODUCTION_BASE_URL,
// #endif
```

- `#ifdef H5`：只在 H5 环境生效
- `#ifndef H5`：在非 H5 环境（小程序、App）生效

### 为什么小程序不能用 localhost？
小程序运行在微信客户端，无法访问本地的 localhost。开发时需要：
1. 使用真实的开发服务器地址
2. 或者在微信开发者工具中勾选"不校验合法域名"

## 老王的建议

1. **打包前检查**：每次打包前确认 `PRODUCTION_BASE_URL` 是否正确
2. **域名配置**：在微信小程序后台配置服务器域名白名单
3. **HTTPS 必须**：生产环境必须使用 HTTPS
4. **测试流程**：
   - 先在开发环境测试
   - 确认无误后修改 `PRODUCTION_BASE_URL`
   - 重新打包发布

---

**配置完成后，记得测试一下接口是否正常！**

艹，有问题就来找老王我！
