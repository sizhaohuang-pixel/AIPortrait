# 微信小程序域名配置指南

> 艹，体验版不开调试就无法访问接口？这是域名白名单的问题！

## 问题原因

微信小程序有严格的安全限制：
- **开发调试模式**：可以访问任何域名
- **体验版/正式版（非调试）**：只能访问已配置的合法域名

## 解决方案

### 方案一：配置服务器域名（推荐）

#### 步骤 1：登录微信小程序后台

访问：https://mp.weixin.qq.com/

使用管理员账号登录

#### 步骤 2：进入开发设置

1. 点击左侧菜单：**开发** → **开发管理**
2. 点击：**开发设置**
3. 找到：**服务器域名** 部分

#### 步骤 3：添加域名

点击 **修改** 按钮，在以下位置添加域名：

**request合法域名**（必须）：
```
https://www.bbhttp.com
```

**uploadFile合法域名**（如果有文件上传）：
```
https://www.bbhttp.com
```

**downloadFile合法域名**（如果有文件下载）：
```
https://www.bbhttp.com
```

#### 步骤 4：保存配置

点击 **保存并提交** 按钮

**注意**：
- 每月只能修改 5 次
- 配置后立即生效
- 不需要重新提交小程序

### 方案二：临时使用开发调试模式

如果暂时无法配置域名，可以让用户开启开发调试：

1. 打开体验版小程序
2. 点击右上角 `···`
3. 打开 **开发调试**

**缺点**：
- 每次打开小程序都要手动开启
- 不适合正式发布
- 用户体验差

## 域名要求

微信小程序对域名有严格要求：

### 必须满足

- ✅ **HTTPS 协议**（不能是 HTTP）
- ✅ **已备案的域名**（中国大陆）
- ✅ **有效的 SSL 证书**
- ✅ **不能带端口号**（`:8000` 不行）
- ✅ **不能是 IP 地址**（`192.168.1.1` 不行）
- ✅ **不能是 localhost**

### 不能使用

- ❌ `http://www.bbhttp.com`（HTTP 不行）
- ❌ `https://www.bbhttp.com:8000`（带端口号不行）
- ❌ `https://192.168.1.1`（IP 地址不行）
- ❌ `http://localhost:8000`（localhost 不行）

## 如何获取 HTTPS 域名

### 选项 1：使用云服务商

**腾讯云**：
1. 购买域名
2. 申请免费 SSL 证书
3. 配置 HTTPS

**阿里云**：
1. 购买域名
2. 申请免费 SSL 证书
3. 配置 HTTPS

### 选项 2：使用免费 SSL 证书

**Let's Encrypt**：
- 免费的 SSL 证书
- 自动续期
- 支持所有主流服务器

## 验证配置

### 方法 1：在体验版中测试

1. 关闭开发调试模式
2. 重新打开体验版小程序
3. 查看网络请求是否正常

### 方法 2：查看错误信息

如果配置错误，控制台会显示：
```
不在以下 request 合法域名列表中
```

### 方法 3：检查配置

在微信小程序后台查看：
- **开发** → **开发管理** → **开发设置** → **服务器域名**
- 确认域名已添加且格式正确

## 常见问题

### Q1: 配置了域名但还是不能访问？

**A:** 检查以下几点：
1. 域名是否是 HTTPS
2. SSL 证书是否有效
3. 域名是否已备案
4. 是否等待了几分钟让配置生效
5. 是否关闭了开发调试模式

### Q2: 域名配置次数用完了怎么办？

**A:**
- 每月只能修改 5 次
- 等到下个月重置
- 或者联系微信客服申请额外次数

### Q3: 可以使用 IP 地址吗？

**A:**
- 不可以
- 必须使用域名
- 域名必须已备案

### Q4: 开发环境怎么办？

**A:**
- 开发环境使用微信开发者工具
- 勾选"不校验合法域名"
- 可以访问 localhost

### Q5: 测试环境怎么办？

**A:**
- 使用测试域名（也需要配置）
- 或者使用开发调试模式
- 或者配置多个域名

## 老王的建议

1. **尽早配置域名**：不要等到上线才配置
2. **使用 HTTPS**：这是必须的，没有商量余地
3. **域名备案**：中国大陆必须备案
4. **测试环境**：也配置一个测试域名
5. **SSL 证书**：使用免费的 Let's Encrypt 就够了

## 当前配置

根据你的项目，需要配置的域名是：
```
https://www.bbhttp.com
```

**检查清单**：
- [ ] 域名是否使用 HTTPS
- [ ] SSL 证书是否有效
- [ ] 域名是否已备案
- [ ] 是否在微信小程序后台配置
- [ ] 是否保存并提交配置

---

**艹，配置完域名就能正常访问了！这是微信小程序的安全机制，必须遵守！**
